<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diwali Greetings Studio - Create Beautiful Digital Cards</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Dancing+Script:wght@400;600;700&family=Pacifico&family=Great+Vibes&family=Satisfy&family=Cinzel:wght@400;500;600&family=Allura&family=Poppins:wght@300;400;500;600;700&family=Libre+Baskerville:wght@400;700&family=Righteous&display=swap" rel="stylesheet">
    
    <style>
        :root {
  /* Primitive Color Tokens */
  --color-white: rgba(255, 255, 255, 1);
  --color-black: rgba(0, 0, 0, 1);
  --color-cream-50: rgba(252, 252, 249, 1);
  --color-cream-100: rgba(255, 255, 253, 1);
  --color-gray-200: rgba(245, 245, 245, 1);
  --color-gray-300: rgba(167, 169, 169, 1);
  --color-gray-400: rgba(119, 124, 124, 1);
  --color-slate-500: rgba(98, 108, 113, 1);
  --color-brown-600: rgba(94, 82, 64, 1);
  --color-charcoal-700: rgba(31, 33, 33, 1);
  --color-charcoal-800: rgba(38, 40, 40, 1);
  --color-slate-900: rgba(19, 52, 59, 1);
  --color-teal-300: rgba(50, 184, 198, 1);
  --color-teal-400: rgba(45, 166, 178, 1);
  --color-teal-500: rgba(33, 128, 141, 1);
  --color-teal-600: rgba(29, 116, 128, 1);
  --color-teal-700: rgba(26, 104, 115, 1);
  --color-teal-800: rgba(41, 150, 161, 1);
  --color-red-400: rgba(255, 84, 89, 1);
  --color-red-500: rgba(192, 21, 47, 1);
  --color-orange-400: rgba(230, 129, 97, 1);
  --color-orange-500: rgba(168, 75, 47, 1);

  /* RGB versions for opacity control */
  --color-brown-600-rgb: 94, 82, 64;
  --color-teal-500-rgb: 33, 128, 141;
  --color-slate-900-rgb: 19, 52, 59;
  --color-slate-500-rgb: 98, 108, 113;
  --color-red-500-rgb: 192, 21, 47;
  --color-red-400-rgb: 255, 84, 89;
  --color-orange-500-rgb: 168, 75, 47;
  --color-orange-400-rgb: 230, 129, 97;

  /* Background color tokens (Light Mode) */
  --color-bg-1: rgba(59, 130, 246, 0.08); /* Light blue */
  --color-bg-2: rgba(245, 158, 11, 0.08); /* Light yellow */
  --color-bg-3: rgba(34, 197, 94, 0.08); /* Light green */
  --color-bg-4: rgba(239, 68, 68, 0.08); /* Light red */
  --color-bg-5: rgba(147, 51, 234, 0.08); /* Light purple */
  --color-bg-6: rgba(249, 115, 22, 0.08); /* Light orange */
  --color-bg-7: rgba(236, 72, 153, 0.08); /* Light pink */
  --color-bg-8: rgba(6, 182, 212, 0.08); /* Light cyan */

  /* Semantic Color Tokens (Light Mode) */
  --color-background: var(--color-cream-50);
  --color-surface: var(--color-cream-100);
  --color-text: var(--color-slate-900);
  --color-text-secondary: var(--color-slate-500);
  --color-primary: var(--color-teal-500);
  --color-primary-hover: var(--color-teal-600);
  --color-primary-active: var(--color-teal-700);
  --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
  --color-secondary-hover: rgba(var(--color-brown-600-rgb), 0.2);
  --color-secondary-active: rgba(var(--color-brown-600-rgb), 0.25);
  --color-border: rgba(var(--color-brown-600-rgb), 0.2);
  --color-btn-primary-text: var(--color-cream-50);
  --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
  --color-card-border-inner: rgba(var(--color-brown-600-rgb), 0.12);
  --color-error: var(--color-red-500);
  --color-success: var(--color-teal-500);
  --color-warning: var(--color-orange-500);
  --color-info: var(--color-slate-500);
  --color-focus-ring: rgba(var(--color-teal-500-rgb), 0.4);
  --color-select-caret: rgba(var(--color-slate-900-rgb), 0.8);

  /* Common style patterns */
  --focus-ring: 0 0 0 3px var(--color-focus-ring);
  --focus-outline: 2px solid var(--color-primary);
  --status-bg-opacity: 0.15;
  --status-border-opacity: 0.25;
  --select-caret-light: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23134252' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
  --select-caret-dark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23f5f5f5' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");

  /* RGB versions for opacity control */
  --color-success-rgb: 33, 128, 141;
  --color-error-rgb: 192, 21, 47;
  --color-warning-rgb: 168, 75, 47;
  --color-info-rgb: 98, 108, 113;

  /* Typography */
  --font-family-base: "FKGroteskNeue", "Geist", "Inter", -apple-system,
    BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  --font-family-mono: "Berkeley Mono", ui-monospace, SFMono-Regular, Menlo,
    Monaco, Consolas, monospace;
  --font-size-xs: 11px;
  --font-size-sm: 12px;
  --font-size-base: 14px;
  --font-size-md: 14px;
  --font-size-lg: 16px;
  --font-size-xl: 18px;
  --font-size-2xl: 20px;
  --font-size-3xl: 24px;
  --font-size-4xl: 30px;
  --font-weight-normal: 400;
  --font-weight-medium: 500;
  --font-weight-semibold: 550;
  --font-weight-bold: 600;
  --line-height-tight: 1.2;
  --line-height-normal: 1.5;
  --letter-spacing-tight: -0.01em;

  /* Spacing */
  --space-0: 0;
  --space-1: 1px;
  --space-2: 2px;
  --space-4: 4px;
  --space-6: 6px;
  --space-8: 8px;
  --space-10: 10px;
  --space-12: 12px;
  --space-16: 16px;
  --space-20: 20px;
  --space-24: 24px;
  --space-32: 32px;

  /* Border Radius */
  --radius-sm: 6px;
  --radius-base: 8px;
  --radius-md: 10px;
  --radius-lg: 12px;
  --radius-full: 9999px;

  /* Shadows */
  --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.02);
  --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02);
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04),
    0 2px 4px -1px rgba(0, 0, 0, 0.02);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.04),
    0 4px 6px -2px rgba(0, 0, 0, 0.02);
  --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.15),
    inset 0 -1px 0 rgba(0, 0, 0, 0.03);

  /* Animation */
  --duration-fast: 150ms;
  --duration-normal: 250ms;
  --ease-standard: cubic-bezier(0.16, 1, 0.3, 1);

  /* Layout */
  --container-sm: 640px;
  --container-md: 768px;
  --container-lg: 1024px;
  --container-xl: 1280px;
}

/* Dark mode colors */
@media (prefers-color-scheme: dark) {
  :root {
    /* RGB versions for opacity control (Dark Mode) */
    --color-gray-400-rgb: 119, 124, 124;
    --color-teal-300-rgb: 50, 184, 198;
    --color-gray-300-rgb: 167, 169, 169;
    --color-gray-200-rgb: 245, 245, 245;

    /* Background color tokens (Dark Mode) */
    --color-bg-1: rgba(29, 78, 216, 0.15); /* Dark blue */
    --color-bg-2: rgba(180, 83, 9, 0.15); /* Dark yellow */
    --color-bg-3: rgba(21, 128, 61, 0.15); /* Dark green */
    --color-bg-4: rgba(185, 28, 28, 0.15); /* Dark red */
    --color-bg-5: rgba(107, 33, 168, 0.15); /* Dark purple */
    --color-bg-6: rgba(194, 65, 12, 0.15); /* Dark orange */
    --color-bg-7: rgba(190, 24, 93, 0.15); /* Dark pink */
    --color-bg-8: rgba(8, 145, 178, 0.15); /* Dark cyan */

    /* Semantic Color Tokens (Dark Mode) */
    --color-background: var(--color-charcoal-700);
    --color-surface: var(--color-charcoal-800);
    --color-text: var(--color-gray-200);
    --color-text-secondary: rgba(var(--color-gray-300-rgb), 0.7);
    --color-primary: var(--color-teal-300);
    --color-primary-hover: var(--color-teal-400);
    --color-primary-active: var(--color-teal-800);
    --color-secondary: rgba(var(--color-gray-400-rgb), 0.15);
    --color-secondary-hover: rgba(var(--color-gray-400-rgb), 0.25);
    --color-secondary-active: rgba(var(--color-gray-400-rgb), 0.3);
    --color-border: rgba(var(--color-gray-400-rgb), 0.3);
    --color-error: var(--color-red-400);
    --color-success: var(--color-teal-300);
    --color-warning: var(--color-orange-400);
    --color-info: var(--color-gray-300);
    --color-focus-ring: rgba(var(--color-teal-300-rgb), 0.4);
    --color-btn-primary-text: var(--color-slate-900);
    --color-card-border: rgba(var(--color-gray-400-rgb), 0.2);
    --color-card-border-inner: rgba(var(--color-gray-400-rgb), 0.15);
    --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.1),
      inset 0 -1px 0 rgba(0, 0, 0, 0.15);
    --button-border-secondary: rgba(var(--color-gray-400-rgb), 0.2);
    --color-border-secondary: rgba(var(--color-gray-400-rgb), 0.2);
    --color-select-caret: rgba(var(--color-gray-200-rgb), 0.8);

    /* RGB versions for dark mode */
    --color-success-rgb: var(--color-teal-300-rgb);
    --color-error-rgb: var(--color-red-400-rgb);
    --color-warning-rgb: var(--color-orange-400-rgb);
    --color-info-rgb: var(--color-gray-300-rgb);
  }
}

/* Data attribute for manual theme switching */
[data-color-scheme="dark"] {
  /* RGB versions for opacity control (dark mode) */
  --color-gray-400-rgb: 119, 124, 124;
  --color-teal-300-rgb: 50, 184, 198;
  --color-gray-300-rgb: 167, 169, 169;
  --color-gray-200-rgb: 245, 245, 245;

  /* Colorful background palette - Dark Mode */
  --color-bg-1: rgba(29, 78, 216, 0.15); /* Dark blue */
  --color-bg-2: rgba(180, 83, 9, 0.15); /* Dark yellow */
  --color-bg-3: rgba(21, 128, 61, 0.15); /* Dark green */
  --color-bg-4: rgba(185, 28, 28, 0.15); /* Dark red */
  --color-bg-5: rgba(107, 33, 168, 0.15); /* Dark purple */
  --color-bg-6: rgba(194, 65, 12, 0.15); /* Dark orange */
  --color-bg-7: rgba(190, 24, 93, 0.15); /* Dark pink */
  --color-bg-8: rgba(8, 145, 178, 0.15); /* Dark cyan */

  /* Semantic Color Tokens (Dark Mode) */
  --color-background: var(--color-charcoal-700);
  --color-surface: var(--color-charcoal-800);
  --color-text: var(--color-gray-200);
  --color-text-secondary: rgba(var(--color-gray-300-rgb), 0.7);
  --color-primary: var(--color-teal-300);
  --color-primary-hover: var(--color-teal-400);
  --color-primary-active: var(--color-teal-800);
  --color-secondary: rgba(var(--color-gray-400-rgb), 0.15);
  --color-secondary-hover: rgba(var(--color-gray-400-rgb), 0.25);
  --color-secondary-active: rgba(var(--color-gray-400-rgb), 0.3);
  --color-border: rgba(var(--color-gray-400-rgb), 0.3);
  --color-error: var(--color-red-400);
  --color-success: var(--color-teal-300);
  --color-warning: var(--color-orange-400);
  --color-info: var(--color-gray-300);
  --color-focus-ring: rgba(var(--color-teal-300-rgb), 0.4);
  --color-btn-primary-text: var(--color-slate-900);
  --color-card-border: rgba(var(--color-gray-400-rgb), 0.15);
  --color-card-border-inner: rgba(var(--color-gray-400-rgb), 0.15);
  --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.1),
    inset 0 -1px 0 rgba(0, 0, 0, 0.15);
  --color-border-secondary: rgba(var(--color-gray-400-rgb), 0.2);
  --color-select-caret: rgba(var(--color-gray-200-rgb), 0.8);

  /* RGB versions for dark mode */
  --color-success-rgb: var(--color-teal-300-rgb);
  --color-error-rgb: var(--color-red-400-rgb);
  --color-warning-rgb: var(--color-orange-400-rgb);
  --color-info-rgb: var(--color-gray-300-rgb);
}

[data-color-scheme="light"] {
  /* RGB versions for opacity control (light mode) */
  --color-brown-600-rgb: 94, 82, 64;
  --color-teal-500-rgb: 33, 128, 141;
  --color-slate-900-rgb: 19, 52, 59;

  /* Semantic Color Tokens (Light Mode) */
  --color-background: var(--color-cream-50);
  --color-surface: var(--color-cream-100);
  --color-text: var(--color-slate-900);
  --color-text-secondary: var(--color-slate-500);
  --color-primary: var(--color-teal-500);
  --color-primary-hover: var(--color-teal-600);
  --color-primary-active: var(--color-teal-700);
  --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
  --color-secondary-hover: rgba(var(--color-brown-600-rgb), 0.2);
  --color-secondary-active: rgba(var(--color-brown-600-rgb), 0.25);
  --color-border: rgba(var(--color-brown-600-rgb), 0.2);
  --color-btn-primary-text: var(--color-cream-50);
  --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
  --color-card-border-inner: rgba(var(--color-brown-600-rgb), 0.12);
  --color-error: var(--color-red-500);
  --color-success: var(--color-teal-500);
  --color-warning: var(--color-orange-500);
  --color-info: var(--color-slate-500);
  --color-focus-ring: rgba(var(--color-teal-500-rgb), 0.4);

  /* RGB versions for light mode */
  --color-success-rgb: var(--color-teal-500-rgb);
  --color-error-rgb: var(--color-red-500-rgb);
  --color-warning-rgb: var(--color-orange-500-rgb);
  --color-info-rgb: var(--color-slate-500-rgb);
}

/* Base styles */
html {
  font-size: var(--font-size-base);
  font-family: var(--font-family-base);
  line-height: var(--line-height-normal);
  color: var(--color-text);
  background-color: var(--color-background);
  -webkit-font-smoothing: antialiased;
  box-sizing: border-box;
}

body {
  margin: 0;
  padding: 0;
}

*,
*::before,
*::after {
  box-sizing: inherit;
}

/* Typography */
h1,
h2,
h3,
h4,
h5,
h6 {
  margin: 0;
  font-weight: var(--font-weight-semibold);
  line-height: var(--line-height-tight);
  color: var(--color-text);
  letter-spacing: var(--letter-spacing-tight);
}

h1 {
  font-size: var(--font-size-4xl);
}
h2 {
  font-size: var(--font-size-3xl);
}
h3 {
  font-size: var(--font-size-2xl);
}
h4 {
  font-size: var(--font-size-xl);
}
h5 {
  font-size: var(--font-size-lg);
}
h6 {
  font-size: var(--font-size-md);
}

p {
  margin: 0 0 var(--space-16) 0;
}

a {
  color: var(--color-primary);
  text-decoration: none;
  transition: color var(--duration-fast) var(--ease-standard);
}

a:hover {
  color: var(--color-primary-hover);
}

code,
pre {
  font-family: var(--font-family-mono);
  font-size: calc(var(--font-size-base) * 0.95);
  background-color: var(--color-secondary);
  border-radius: var(--radius-sm);
}

code {
  padding: var(--space-1) var(--space-4);
}

pre {
  padding: var(--space-16);
  margin: var(--space-16) 0;
  overflow: auto;
  border: 1px solid var(--color-border);
}

pre code {
  background: none;
  padding: 0;
}

/* Buttons */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: var(--space-8) var(--space-16);
  border-radius: var(--radius-base);
  font-size: var(--font-size-base);
  font-weight: 500;
  line-height: 1.5;
  cursor: pointer;
  transition: all var(--duration-normal) var(--ease-standard);
  border: none;
  text-decoration: none;
  position: relative;
}

.btn:focus-visible {
  outline: none;
  box-shadow: var(--focus-ring);
}

.btn--primary {
  background: var(--color-primary);
  color: var(--color-btn-primary-text);
}

.btn--primary:hover {
  background: var(--color-primary-hover);
}

.btn--primary:active {
  background: var(--color-primary-active);
}

.btn--secondary {
  background: var(--color-secondary);
  color: var(--color-text);
}

.btn--secondary:hover {
  background: var(--color-secondary-hover);
}

.btn--secondary:active {
  background: var(--color-secondary-active);
}

.btn--outline {
  background: transparent;
  border: 1px solid var(--color-border);
  color: var(--color-text);
}

.btn--outline:hover {
  background: var(--color-secondary);
}

.btn--sm {
  padding: var(--space-4) var(--space-12);
  font-size: var(--font-size-sm);
  border-radius: var(--radius-sm);
}

.btn--lg {
  padding: var(--space-10) var(--space-20);
  font-size: var(--font-size-lg);
  border-radius: var(--radius-md);
}

.btn--full-width {
  width: 100%;
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

/* Form elements */
.form-control {
  display: block;
  width: 100%;
  padding: var(--space-8) var(--space-12);
  font-size: var(--font-size-md);
  line-height: 1.5;
  color: var(--color-text);
  background-color: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-base);
  transition: border-color var(--duration-fast) var(--ease-standard),
    box-shadow var(--duration-fast) var(--ease-standard);
}

textarea.form-control {
  font-family: var(--font-family-base);
  font-size: var(--font-size-base);
}

select.form-control {
  padding: var(--space-8) var(--space-12);
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  background-image: var(--select-caret-light);
  background-repeat: no-repeat;
  background-position: right var(--space-12) center;
  background-size: 16px;
  padding-right: var(--space-32);
}

/* Add a dark mode specific caret */
@media (prefers-color-scheme: dark) {
  select.form-control {
    background-image: var(--select-caret-dark);
  }
}

/* Also handle data-color-scheme */
[data-color-scheme="dark"] select.form-control {
  background-image: var(--select-caret-dark);
}

[data-color-scheme="light"] select.form-control {
  background-image: var(--select-caret-light);
}

.form-control:focus {
  border-color: var(--color-primary);
  outline: var(--focus-outline);
}

.form-label {
  display: block;
  margin-bottom: var(--space-8);
  font-weight: var(--font-weight-medium);
  font-size: var(--font-size-sm);
}

.form-group {
  margin-bottom: var(--space-16);
}

/* Card component */
.card {
  background-color: var(--color-surface);
  border-radius: var(--radius-lg);
  border: 1px solid var(--color-card-border);
  box-shadow: var(--shadow-sm);
  overflow: hidden;
  transition: box-shadow var(--duration-normal) var(--ease-standard);
}

.card:hover {
  box-shadow: var(--shadow-md);
}

.card__body {
  padding: var(--space-16);
}

.card__header,
.card__footer {
  padding: var(--space-16);
  border-bottom: 1px solid var(--color-card-border-inner);
}

/* Status indicators - simplified with CSS variables */
.status {
  display: inline-flex;
  align-items: center;
  padding: var(--space-6) var(--space-12);
  border-radius: var(--radius-full);
  font-weight: var(--font-weight-medium);
  font-size: var(--font-size-sm);
}

.status--success {
  background-color: rgba(
    var(--color-success-rgb, 33, 128, 141),
    var(--status-bg-opacity)
  );
  color: var(--color-success);
  border: 1px solid
    rgba(var(--color-success-rgb, 33, 128, 141), var(--status-border-opacity));
}

.status--error {
  background-color: rgba(
    var(--color-error-rgb, 192, 21, 47),
    var(--status-bg-opacity)
  );
  color: var(--color-error);
  border: 1px solid
    rgba(var(--color-error-rgb, 192, 21, 47), var(--status-border-opacity));
}

.status--warning {
  background-color: rgba(
    var(--color-warning-rgb, 168, 75, 47),
    var(--status-bg-opacity)
  );
  color: var(--color-warning);
  border: 1px solid
    rgba(var(--color-warning-rgb, 168, 75, 47), var(--status-border-opacity));
}

.status--info {
  background-color: rgba(
    var(--color-info-rgb, 98, 108, 113),
    var(--status-bg-opacity)
  );
  color: var(--color-info);
  border: 1px solid
    rgba(var(--color-info-rgb, 98, 108, 113), var(--status-border-opacity));
}

/* Container layout */
.container {
  width: 100%;
  margin-right: auto;
  margin-left: auto;
  padding-right: var(--space-16);
  padding-left: var(--space-16);
}

@media (min-width: 640px) {
  .container {
    max-width: var(--container-sm);
  }
}
@media (min-width: 768px) {
  .container {
    max-width: var(--container-md);
  }
}
@media (min-width: 1024px) {
  .container {
    max-width: var(--container-lg);
  }
}
@media (min-width: 1280px) {
  .container {
    max-width: var(--container-xl);
  }
}

/* Utility classes */
.flex {
  display: flex;
}
.flex-col {
  flex-direction: column;
}
.items-center {
  align-items: center;
}
.justify-center {
  justify-content: center;
}
.justify-between {
  justify-content: space-between;
}
.gap-4 {
  gap: var(--space-4);
}
.gap-8 {
  gap: var(--space-8);
}
.gap-16 {
  gap: var(--space-16);
}

.m-0 {
  margin: 0;
}
.mt-8 {
  margin-top: var(--space-8);
}
.mb-8 {
  margin-bottom: var(--space-8);
}
.mx-8 {
  margin-left: var(--space-8);
  margin-right: var(--space-8);
}
.my-8 {
  margin-top: var(--space-8);
  margin-bottom: var(--space-8);
}

.p-0 {
  padding: 0;
}
.py-8 {
  padding-top: var(--space-8);
  padding-bottom: var(--space-8);
}
.px-8 {
  padding-left: var(--space-8);
  padding-right: var(--space-8);
}
.py-16 {
  padding-top: var(--space-16);
  padding-bottom: var(--space-16);
}
.px-16 {
  padding-left: var(--space-16);
  padding-right: var(--space-16);
}

.block {
  display: block;
}
.hidden {
  display: none;
}

/* Accessibility */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

:focus-visible {
  outline: var(--focus-outline);
  outline-offset: 2px;
}

/* Dark mode specifics */
[data-color-scheme="dark"] .btn--outline {
  border: 1px solid var(--color-border-secondary);
}

@font-face {
  font-family: 'FKGroteskNeue';
  src: url('https://r2cdn.perplexity.ai/fonts/FKGroteskNeue.woff2')
    format('woff2');
}

/* END PERPLEXITY DESIGN SYSTEM */

/* Custom Diwali Platform Styles */

/* Navigation */
.navbar {
    background: linear-gradient(135deg, #FFD700, #FF6B35);
    padding: var(--space-16) var(--space-20);
    box-shadow: var(--shadow-lg);
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 1000;
    transition: background var(--duration-normal) var(--ease-standard);
}

[data-color-scheme="dark"] .navbar {
    background: linear-gradient(135deg, #FFA500, #FF1493);
}

.navbar-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    max-width: 1400px;
    margin: 0 auto;
}

.navbar-brand {
    font-family: 'Cinzel', serif;
    font-size: var(--font-size-3xl);
    font-weight: var(--font-weight-bold);
    color: var(--color-white);
    display: flex;
    align-items: center;
    gap: var(--space-12);
}

.diya-icon {
    font-size: var(--font-size-4xl);
    animation: float 2s ease-in-out infinite;
}

@keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-5px); }
}

.theme-toggle {
    background: rgba(255, 255, 255, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: var(--radius-full);
    padding: var(--space-8);
    cursor: pointer;
    transition: all var(--duration-normal) var(--ease-standard);
    font-size: var(--font-size-xl);
}

.theme-toggle:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: scale(1.1);
}

/* Main Layout - Modified for Resizable Panels */
.app-container {
    display: flex;
    height: 100vh;
    margin-top: 80px; /* Account for fixed navbar */
    gap: 0; /* No gap - handles will provide visual separation */
    padding: var(--space-16);
    background: var(--color-background);
    transition: background var(--duration-normal) var(--ease-standard);
    position: relative;
}

/* Resizable Sidebars */
.sidebar {
    width: 400px;
    min-width: 200px;
    max-width: 600px;
    background: var(--color-surface);
    border-radius: var(--radius-lg);
    padding: var(--space-20);
    box-shadow: var(--shadow-md);
    /* REMOVED: overflow-y: auto; - This removes the scrollbar */
    overflow: hidden; /* Hide content that overflows instead */
    max-height: calc(100vh - 120px);
    position: relative;
    user-select: none; /* Prevent text selection during resize */
}

/* Left sidebar content scrollable area */
.sidebar-content {
    height: 100%;
    overflow-y: auto;
    padding-right: 8px; /* Space for custom scrollbar */
}

/* Custom scrollbar styling */
.sidebar-content::-webkit-scrollbar {
    width: 6px;
}

.sidebar-content::-webkit-scrollbar-track {
    background: var(--color-secondary);
    border-radius: 3px;
}

.sidebar-content::-webkit-scrollbar-thumb {
    background: var(--color-primary);
    border-radius: 3px;
}

.sidebar-content::-webkit-scrollbar-thumb:hover {
    background: var(--color-primary-hover);
}

/* For Firefox */
.sidebar-content {
    scrollbar-width: thin;
    scrollbar-color: var(--color-primary) var(--color-secondary);
}

.sidebar h3 {
    font-family: 'Cinzel', serif;
    color: var(--color-primary);
    margin-bottom: var(--space-16);
    font-size: var(--font-size-xl);
}

/* Resize Handles */
.resize-handle {
    position: absolute;
    top: 0;
    bottom: 0;
    width: 6px;
    background: transparent;
    cursor: ew-resize;
    z-index: 1000;
    transition: background var(--duration-fast) var(--ease-standard);
}

.resize-handle:hover {
    background: var(--color-primary);
    opacity: 0.3;
}

.resize-handle.resizing {
    background: var(--color-primary);
    opacity: 0.5;
}

.resize-handle-left {
    right: -3px; /* Position on right edge of left sidebar */
}

.resize-handle-right {
    left: -3px; /* Position on left edge of right sidebar */
}

/* Canvas Area */
.canvas-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    background: var(--color-surface);
    border-radius: var(--radius-lg);
    padding: var(--space-20);
    box-shadow: var(--shadow-lg);
    position: relative;
    margin: 0 var(--space-8); /* Small margin between panels */
}

.canvas-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-20);
}

.canvas-wrapper {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    min-height: 500px;
}

#greeting-canvas {
    border: 3px solid var(--color-primary);
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-lg);
    cursor: crosshair;
    transition: border-color var(--duration-normal) var(--ease-standard);
    background: var(--color-white);
}

#greeting-canvas:hover {
    border-color: var(--color-primary-hover);
}

/* Template Grid */
.template-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--space-12);
    margin-bottom: var(--space-20);
}

.template-card {
    background: linear-gradient(135deg, #FF6B35, #F7931E);
    border-radius: var(--radius-md);
    padding: var(--space-12);
    cursor: pointer;
    transition: all var(--duration-normal) var(--ease-standard);
    text-align: center;
    color: var(--color-white);
    font-weight: var(--font-weight-medium);
    font-size: var(--font-size-sm);
    position: relative;
    overflow: hidden;
}

.template-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s;
}

.template-card:hover::before {
    left: 100%;
}

.template-card:hover {
    transform: scale(1.05);
    box-shadow: var(--shadow-lg);
}

.template-card.active {
    background: linear-gradient(135deg, #004E89, #1A659E);
    box-shadow: 0 0 20px rgba(0, 78, 137, 0.5);
}

/* Color Themes */
.color-themes {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: var(--space-8);
    margin-bottom: var(--space-20);
}

.color-theme {
    width: 40px;
    height: 40px;
    border-radius: var(--radius-full);
    cursor: pointer;
    transition: all var(--duration-normal) var(--ease-standard);
    border: 3px solid transparent;
}

.color-theme:hover {
    transform: scale(1.1);
    box-shadow: var(--shadow-md);
}

.color-theme.active {
    border-color: var(--color-primary);
    box-shadow: 0 0 15px rgba(var(--color-primary-rgb), 0.5);
}

/* Elements Library */
.elements-tabs {
    display: flex;
    margin-bottom: var(--space-16);
    border-bottom: 1px solid var(--color-border);
}

.tab-button {
    background: none;
    border: none;
    padding: var(--space-8) var(--space-16);
    cursor: pointer;
    font-size: var(--font-size-sm);
    color: var(--color-text-secondary);
    transition: all var(--duration-normal) var(--ease-standard);
    border-bottom: 2px solid transparent;
    font-weight: var(--font-weight-medium);
}

.tab-button:hover {
    color: var(--color-primary);
}

.tab-button.active {
    color: var(--color-primary);
    border-bottom-color: var(--color-primary);
}

.elements-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--space-8);
    margin-bottom: var(--space-16);
}

.element-button {
    background: var(--color-bg-1);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-base);
    padding: var(--space-12);
    cursor: pointer;
    transition: all var(--duration-normal) var(--ease-standard);
    font-size: var(--font-size-xl);
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 60px;
}

.element-button:hover {
    background: var(--color-bg-2);
    transform: scale(1.05);
    box-shadow: var(--shadow-sm);
}

/* Text Controls */
.text-controls {
    display: flex;
    flex-direction: column;
    gap: var(--space-16);
    margin-bottom: var(--space-20);
}

.font-controls {
    display: grid;
    grid-template-columns: 1fr 80px;
    gap: var(--space-8);
    align-items: end;
}

.text-format-buttons {
    display: flex;
    gap: var(--space-4);
}

.format-button {
    background: var(--color-secondary);
    border: 1px solid var(--color-border);
    border-radius: var(--radius-sm);
    padding: var(--space-6) var(--space-10);
    cursor: pointer;
    font-size: var(--font-size-sm);
    font-weight: var(--font-weight-bold);
    transition: all var(--duration-normal) var(--ease-standard);
}

.format-button:hover {
    background: var(--color-secondary-hover);
}

.format-button.active {
    background: var(--color-primary);
    color: var(--color-white);
}

/* Color Picker */
.color-picker-wrapper {
    position: relative;
    display: inline-block;
}

.color-picker {
    width: 50px;
    height: 35px;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-sm);
    cursor: pointer;
    appearance: none;
    background: none;
}

.color-picker::-webkit-color-swatch-wrapper {
    padding: 0;
}

.color-picker::-webkit-color-swatch {
    border: none;
    border-radius: var(--radius-sm);
}

/* Action Buttons */
.action-bar {
    position: fixed;
    bottom: var(--space-20);
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: var(--space-16);
    background: var(--color-surface);
    padding: var(--space-16) var(--space-24);
    border-radius: var(--radius-full);
    box-shadow: var(--shadow-lg);
    z-index: 100;
}

.action-button {
    background: linear-gradient(135deg, var(--color-primary), var(--color-primary-hover));
    color: var(--color-white);
    border: none;
    border-radius: var(--radius-md);
    padding: var(--space-12) var(--space-20);
    font-weight: var(--font-weight-bold);
    cursor: pointer;
    transition: all var(--duration-normal) var(--ease-standard);
    box-shadow: var(--shadow-sm);
}

.action-button:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

.action-button--primary {
    background: linear-gradient(135deg, #FFD700, #FF6B35);
    animation: pulse-glow 2s infinite;
}

@keyframes pulse-glow {
    0%, 100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.3); }
    50% { box-shadow: 0 0 30px rgba(255, 215, 0, 0.6); }
}

/* Toast Notifications */
.toast {
    position: fixed;
    top: 100px;
    right: var(--space-20);
    background: var(--color-success);
    color: var(--color-white);
    padding: var(--space-12) var(--space-20);
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-lg);
    z-index: 1001;
    transform: translateX(400px);
    transition: transform var(--duration-normal) var(--ease-standard);
}

.toast.show {
    transform: translateX(0);
}

/* Card History */
.card-history {
    display: flex;
    gap: var(--space-8);
    overflow-x: auto;
    padding: var(--space-8) 0;
    margin-bottom: var(--space-16);
}

.history-thumbnail {
    width: 80px;
    height: 60px;
    border: 2px solid var(--color-border);
    border-radius: var(--radius-sm);
    cursor: pointer;
    flex-shrink: 0;
    transition: all var(--duration-normal) var(--ease-standard);
    background: var(--color-white);
}

.history-thumbnail:hover {
    border-color: var(--color-primary);
    transform: scale(1.05);
}

/* Selection Handles */
.selection-handle {
    position: absolute;
    width: 8px;
    height: 8px;
    background: var(--color-primary);
    border: 2px solid var(--color-white);
    border-radius: 50%;
    cursor: pointer;
}

.resize-handle {
    cursor: nw-resize;
}

.rotate-handle {
    width: 12px;
    height: 12px;
    background: var(--color-warning);
    cursor: grab;
}

/* Responsive */
@media (max-width: 1200px) {
    .app-container {
        flex-direction: column;
        height: auto;
    }
    
    .sidebar {
        width: 100%;
        max-height: 300px;
    }
    
    .resize-handle {
        display: none; /* Hide resize handles on mobile */
    }
    
    .action-bar {
        position: relative;
        left: auto;
        bottom: auto;
        transform: none;
        margin-top: var(--space-20);
        justify-content: center;
    }
}

/* Loading Spinner */
.spinner {
    border: 3px solid var(--color-border);
    border-top: 3px solid var(--color-primary);
    border-radius: 50%;
    width: 20px;
    height: 20px;
    animation: spin 1s linear infinite;
    display: inline-block;
    margin-left: var(--space-8);
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Modal */
.modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 2000;
}

.modal.show {
    display: flex;
}

.modal-content {
    background: var(--color-surface);
    border-radius: var(--radius-lg);
    padding: var(--space-24);
    max-width: 500px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    position: relative;
    animation: modalSlideIn 0.3s ease-out;
}

@keyframes modalSlideIn {
    from {
        opacity: 0;
        transform: scale(0.8) translateY(-50px);
    }
    to {
        opacity: 1;
        transform: scale(1) translateY(0);
    }
}

.modal-close {
    position: absolute;
    top: var(--space-16);
    right: var(--space-16);
    background: none;
    border: none;
    font-size: var(--font-size-2xl);
    cursor: pointer;
    color: var(--color-text-secondary);
    transition: color var(--duration-fast) var(--ease-standard);
}

.modal-close:hover {
    color: var(--color-text);
}

/* Slider Input */
input[type="range"] {
    -webkit-appearance: none;
    appearance: none;
    height: 6px;
    border-radius: var(--radius-full);
    background: var(--color-secondary);
    outline: none;
    transition: background var(--duration-fast) var(--ease-standard);
}

input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: var(--color-primary);
    cursor: pointer;
    box-shadow: var(--shadow-sm);
    transition: all var(--duration-fast) var(--ease-standard);
}

input[type="range"]::-webkit-slider-thumb:hover {
    background: var(--color-primary-hover);
    transform: scale(1.1);
}

input[type="range"]::-moz-range-thumb {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: var(--color-primary);
    cursor: pointer;
    border: none;
    box-shadow: var(--shadow-sm);
}
    </style>
</head>
<body data-color-scheme="light">
    <!-- Navigation -->
    <nav class="navbar">
        <div class="navbar-content">
            <div class="navbar-brand">
                <span class="diya-icon">ü™î</span>
                Diwali Greetings Studio
            </div>
            <button class="theme-toggle" onclick="toggleTheme()" title="Toggle Light/Dark Mode">
                <span id="theme-icon">üåô</span>
            </button>
        </div>
    </nav>

    <!-- Main Application Container -->
    <div class="app-container">
        <!-- Left Sidebar - Templates & Themes -->
        <div class="sidebar" id="left-sidebar">
            <div class="sidebar-content">
                <h3>üìã Templates</h3>
                <div class="template-grid" id="template-grid">
                    <!-- Templates will be populated by JavaScript -->
                </div>

                <h3>üé® Color Themes</h3>
                <div class="color-themes" id="color-themes">
                    <!-- Color themes will be populated by JavaScript -->
                </div>

                <h3>üéØ Recipient</h3>
                <div class="form-group">
                    <input type="text" class="form-control" id="recipient-name" placeholder="Enter recipient name">
                </div>

                <h3>üí≠ Messages</h3>
                <div class="form-group">
                    <select class="form-control" id="preset-messages">
                        <option value="">Select a preset message</option>
                        <!-- Messages will be populated by JavaScript -->
                    </select>
                    <button class="btn btn--sm btn--primary" onclick="insertMessage()" style="margin-top: 8px; width: 100%;">Insert Message</button>
                </div>

                <h3>üìú My Cards</h3>
                <div class="card-history" id="card-history">
                    <!-- Card history will be populated by JavaScript -->
                </div>
            </div>
            
            <!-- Left Resize Handle -->
            <div class="resize-handle resize-handle-left" id="left-resize-handle"></div>
        </div>

        <!-- Center Canvas Area -->
        <div class="canvas-container">
            <div class="canvas-header">
                <h2 style="font-family: 'Great Vibes', cursive; color: var(--color-primary);">Design Your Diwali Card</h2>
                <div style="display: flex; gap: 16px; align-items: center;">
                    <button class="btn btn--sm btn--outline" onclick="toggleGrid()" id="grid-toggle">Grid: OFF</button>
                    <button class="btn btn--sm btn--secondary" onclick="zoomOut()">üîç-</button>
                    <span id="zoom-level">100%</span>
                    <button class="btn btn--sm btn--secondary" onclick="zoomIn()">üîç+</button>
                </div>
            </div>
            <div class="canvas-wrapper">
                <canvas id="greeting-canvas" width="1200" height="800"></canvas>
            </div>
        </div>

        <!-- Right Sidebar - Text & Elements -->
        <div class="sidebar" id="right-sidebar">
            <div class="sidebar-content">
                <h3>‚úèÔ∏è Text Tools</h3>
                <div class="text-controls">
                    <div class="form-group">
                        <input type="text" class="form-control" id="text-input" placeholder="Enter your text">
                        <button class="btn btn--sm btn--primary" onclick="addText()" style="margin-top: 8px; width: 100%;">Add Text</button>
                    </div>
                    
                    <div class="font-controls">
                        <select class="form-control" id="font-family">
                            <!-- Fonts will be populated by JavaScript -->
                        </select>
                        <input type="number" class="form-control" id="font-size" value="32" min="12" max="120">
                    </div>
                    
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <label class="form-label">Color:</label>
                        <div class="color-picker-wrapper">
                            <input type="color" class="color-picker" id="text-color" value="#FFD700">
                        </div>
                        <div class="text-format-buttons">
                            <button class="format-button" id="bold-btn" onclick="toggleBold()">B</button>
                            <button class="format-button" id="italic-btn" onclick="toggleItalic()" style="font-style: italic;">I</button>
                            <button class="format-button" id="underline-btn" onclick="toggleUnderline()" style="text-decoration: underline;">U</button>
                        </div>
                    </div>
                </div>

                <h3>üé≠ Elements</h3>
                <div class="elements-tabs">
                    <button class="tab-button active" onclick="switchTab('diyas')" data-tab="diyas">ü™î Diyas</button>
                    <button class="tab-button" onclick="switchTab('rangoli')" data-tab="rangoli">üå∏ Rangoli</button>
                    <button class="tab-button" onclick="switchTab('fireworks')" data-tab="fireworks">üéÜ Fireworks</button>
                </div>
                
                <div class="elements-grid" id="elements-grid">
                    <!-- Elements will be populated by JavaScript -->
                </div>

                <h3>‚ú® Effects</h3>
                <div class="form-group">
                    <label class="form-label">Shadow</label>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <input type="checkbox" id="shadow-enabled" onchange="toggleShadow()">
                        <input type="color" class="color-picker" id="shadow-color" value="#000000" style="width: 30px; height: 25px;">
                        <input type="range" id="shadow-blur" min="0" max="20" value="5" onchange="updateShadow()" style="flex: 1;">
                    </div>
                </div>

                <h3>üóÇÔ∏è Actions</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                    <button class="btn btn--sm btn--secondary" onclick="undo()" id="undo-btn">‚Ü∂ Undo</button>
                    <button class="btn btn--sm btn--secondary" onclick="redo()" id="redo-btn">‚Ü∑ Redo</button>
                    <button class="btn btn--sm btn--outline" onclick="deleteSelected()">üóëÔ∏è Delete</button>
                    <button class="btn btn--sm btn--outline" onclick="clearAll()">üóëÔ∏è Clear All</button>
                </div>
            </div>
            
            <!-- Right Resize Handle -->
            <div class="resize-handle resize-handle-right" id="right-resize-handle"></div>
        </div>
    </div>

    <!-- Action Bar -->
    <div class="action-bar">
        <button class="action-button" onclick="newCard()">üìÑ New Card</button>
        <button class="action-button" onclick="resetToTemplate()">üîÑ Reset</button>
        <button class="action-button action-button--primary" onclick="downloadCard()">üíæ Download Card</button>
        <button class="action-button" onclick="shareCard()">üì§ Share</button>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <span id="toast-message"></span>
    </div>

    <!-- Modal for Share/Help -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">&times;</button>
            <div id="modal-content">
                <!-- Modal content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // Global Variables for Application State
        let canvas, ctx;
        let elements = [];
        let selectedElement = null;
        let isDragging = false;
        let isResizing = false;
        let dragOffset = { x: 0, y: 0 };
        let canvasZoom = 1;
        let showGrid = false;
        let currentTheme = 'light';
        let undoStack = [];
        let redoStack = [];
        let cardHistory = [];
        let currentTemplate = null;
        let textFormatting = {
            bold: false,
            italic: false,
            underline: false
        };

        // Resizable panel variables
        let isResizingPanel = false;
        let resizingPanel = null;
        let startX = 0;
        let startWidth = 0;

        // Application Data
        const templates = [
            {
                name: "Traditional Diya & Rangoli",
                background: { type: 'gradient', colors: ['#FF6B35', '#F7931E'] },
                elements: [
                    { type: 'diya', x: 100, y: 650, size: 80 },
                    { type: 'rangoli', x: 600, y: 400, size: 200 },
                    { type: 'text', content: 'Happy Diwali', x: 600, y: 200, fontSize: 48, fontFamily: 'Cinzel', color: '#FFD700' }
                ]
            },
            {
                name: "Fireworks & Lights",
                background: { type: 'gradient', colors: ['#1a1a2e', '#0f3460'] },
                elements: [
                    { type: 'fireworks', x: 1000, y: 150, size: 120 },
                    { type: 'sparkles', x: 300, y: 300, size: 60 },
                    { type: 'sparkles', x: 800, y: 500, size: 40 }
                ]
            },
            {
                name: "Goddess Lakshmi Blessing",
                background: { type: 'gradient', colors: ['#681b98', '#d1006c'] },
                elements: [
                    { type: 'lotus', x: 600, y: 650, size: 150 },
                    { type: 'om', x: 600, y: 150, size: 100 }
                ]
            },
            {
                name: "Modern Minimalist",
                background: { type: 'gradient', colors: ['#004E89', '#1A659E'] },
                elements: [
                    { type: 'geometric', x: 100, y: 100, size: 80 },
                    { type: 'geometric', x: 1100, y: 100, size: 80 },
                    { type: 'geometric', x: 100, y: 700, size: 80 },
                    { type: 'geometric', x: 1100, y: 700, size: 80 }
                ]
            },
            {
                name: "Golden Mandala",
                background: { type: 'gradient', colors: ['#C17A2E', '#FFD700'] },
                elements: [
                    { type: 'mandala', x: 600, y: 400, size: 300 },
                    { type: 'diya', x: 150, y: 150, size: 60 },
                    { type: 'diya', x: 1050, y: 150, size: 60 },
                    { type: 'diya', x: 150, y: 650, size: 60 },
                    { type: 'diya', x: 1050, y: 650, size: 60 }
                ]
            },
            {
                name: "Peacock & Lotus",
                background: { type: 'gradient', colors: ['#30963A', '#0F7926'] },
                elements: [
                    { type: 'peacock', x: 200, y: 400, size: 120 },
                    { type: 'lotus', x: 1000, y: 400, size: 120 }
                ]
            }
        ];

        const colorThemes = [
            { name: "Golden Prosperity", colors: ["#FFD700", "#FFA500", "#8B4513", "#FFEBCD"] },
            { name: "Royal Purple", colors: ["#681b98", "#d1006c", "#eabf48", "#f5a524"] },
            { name: "Festive Red", colors: ["#D90924", "#EB7107", "#F5C400", "#C230B5"] },
            { name: "Traditional Maroon", colors: ["#891E1B", "#AB2722", "#F79E1F", "#E53C26"] },
            { name: "Deep Blue & Gold", colors: ["#0F1A3C", "#FFD700", "#FF8C00", "#1A659E"] },
            { name: "Pink & Magenta", colors: ["#EA2B97", "#F000EA", "#F8DA3B", "#9B00EE"] },
            { name: "Green & Yellow", colors: ["#30963A", "#F0CE00", "#72D653", "#0F7926"] },
            { name: "Pastel Diwali", colors: ["#BE638A", "#D9A774", "#8B9BAE", "#C6CAD0"] }
        ];

        const presetMessages = [
            "Wishing you a very Happy Diwali!",
            "May this Diwali bring joy, health and wealth to you",
            "Light a lamp of love, blast a chain of sorrow",
            "May the festival of lights brighten your life",
            "Shubh Deepavali! May your life be filled with happiness",
            "Wishing you a Diwali full of celebrations and sweets",
            "May Goddess Lakshmi bless you with prosperity",
            "Let's celebrate the victory of light over darkness",
            "Happy Diwali to you and your family",
            "May the divine light of Diwali spread peace and happiness",
            "Sending you warm wishes on this auspicious festival",
            "May your Diwali be as bright as the fireworks in the sky"
        ];

        const fonts = [
            "Playfair Display", "Dancing Script", "Pacifico", "Great Vibes",
            "Satisfy", "Cinzel", "Allura", "Poppins", "Libre Baskerville", "Righteous"
        ];

        // Element Categories
        const elementCategories = {
            diyas: [
                { name: 'classic-diya', icon: 'ü™î' },
                { name: 'double-diya', icon: 'ü™îü™î' },
                { name: 'ornate-diya', icon: '‚ú®ü™î‚ú®' },
                { name: 'floating-diya', icon: 'üíßü™î' },
                { name: 'golden-diya', icon: 'üåüü™î' }
            ],
            rangoli: [
                { name: 'circular-rangoli', icon: '‚≠ï' },
                { name: 'square-rangoli', icon: '‚¨ú' },
                { name: 'lotus-rangoli', icon: 'ü™∑' },
                { name: 'peacock-rangoli', icon: 'ü¶ö' },
                { name: 'geometric-rangoli', icon: '‚óÜ' }
            ],
            fireworks: [
                { name: 'burst-red', icon: 'üí•' },
                { name: 'burst-gold', icon: '‚ú®' },
                { name: 'burst-multi', icon: 'üéÜ' },
                { name: 'sparkler-gold', icon: 'üéá' },
                { name: 'rocket-trail', icon: 'üöÄ' }
            ],
            flowers: [
                { name: 'lotus-pink', icon: 'ü™∑' },
                { name: 'lotus-white', icon: 'ü§ç' },
                { name: 'marigold', icon: 'üåº' },
                { name: 'rose', icon: 'üåπ' }
            ],
            symbols: [
                { name: 'om', icon: 'üïâÔ∏è' },
                { name: 'swastik', icon: 'üîØ' },
                { name: 'lakshmi-feet', icon: 'üë£' },
                { name: 'ganesha', icon: 'üêò' }
            ],
            decorative: [
                { name: 'peacock', icon: 'ü¶ö' },
                { name: 'border-gold', icon: 'üìø' },
                { name: 'stars', icon: '‚≠ê' },
                { name: 'sparkles', icon: '‚ú®' }
            ]
        };

        // Initialize Application
        function initializeApp() {
            canvas = document.getElementById('greeting-canvas');
            ctx = canvas.getContext('2d');
            
            setupEventListeners();
            setupResizableHandles();
            populateUI();
            loadTemplate(templates[0]); // Load first template by default
            draw();
        }

        // Setup Canvas and UI Event Listeners
        function setupEventListeners() {
            // Canvas mouse events
            canvas.addEventListener('mousedown', handleMouseDown);
            canvas.addEventListener('mousemove', handleMouseMove);
            canvas.addEventListener('mouseup', handleMouseUp);
            canvas.addEventListener('click', handleCanvasClick);
            
            // Keyboard events
            document.addEventListener('keydown', handleKeyDown);
            
            // Form events
            document.getElementById('recipient-name').addEventListener('input', updateRecipientName);
            document.getElementById('text-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') addText();
            });
            document.getElementById('font-family').addEventListener('change', updateSelectedText);
            document.getElementById('font-size').addEventListener('input', updateSelectedText);
            document.getElementById('text-color').addEventListener('change', updateSelectedText);
        }

        // Setup Resizable Panel Handles
        function setupResizableHandles() {
            const leftHandle = document.getElementById('left-resize-handle');
            const rightHandle = document.getElementById('right-resize-handle');
            
            // Left handle
            leftHandle.addEventListener('mousedown', (e) => {
                isResizingPanel = true;
                resizingPanel = 'left';
                startX = e.clientX;
                startWidth = document.getElementById('left-sidebar').offsetWidth;
                leftHandle.classList.add('resizing');
                document.body.style.cursor = 'ew-resize';
                e.preventDefault();
            });
            
            // Right handle  
            rightHandle.addEventListener('mousedown', (e) => {
                isResizingPanel = true;
                resizingPanel = 'right';
                startX = e.clientX;
                startWidth = document.getElementById('right-sidebar').offsetWidth;
                rightHandle.classList.add('resizing');
                document.body.style.cursor = 'ew-resize';
                e.preventDefault();
            });
            
            // Global mouse move and up for resizing
            document.addEventListener('mousemove', (e) => {
                if (!isResizingPanel) return;
                
                const sidebar = document.getElementById(resizingPanel + '-sidebar');
                let newWidth;
                
                if (resizingPanel === 'left') {
                    newWidth = startWidth + (e.clientX - startX);
                } else {
                    newWidth = startWidth - (e.clientX - startX);
                }
                
                // Constrain width
                newWidth = Math.max(200, Math.min(600, newWidth));
                sidebar.style.width = newWidth + 'px';
            });
            
            document.addEventListener('mouseup', () => {
                if (isResizingPanel) {
                    isResizingPanel = false;
                    document.getElementById('left-resize-handle').classList.remove('resizing');
                    document.getElementById('right-resize-handle').classList.remove('resizing');
                    document.body.style.cursor = 'default';
                    resizingPanel = null;
                }
            });
        }

        // Populate UI Elements
        function populateUI() {
            // Populate templates
            const templateGrid = document.getElementById('template-grid');
            templates.forEach((template, index) => {
                const templateCard = document.createElement('div');
                templateCard.className = 'template-card';
                templateCard.textContent = template.name;
                templateCard.onclick = () => loadTemplate(template, index);
                if (index === 0) templateCard.classList.add('active');
                templateGrid.appendChild(templateCard);
            });

            // Populate color themes
            const colorThemesContainer = document.getElementById('color-themes');
            colorThemes.forEach((theme, index) => {
                const themeElement = document.createElement('div');
                themeElement.className = 'color-theme';
                themeElement.style.background = `linear-gradient(135deg, ${theme.colors[0]}, ${theme.colors[1]})`;
                themeElement.title = theme.name;
                themeElement.onclick = () => applyColorTheme(theme, index);
                colorThemesContainer.appendChild(themeElement);
            });

            // Populate preset messages
            const messagesSelect = document.getElementById('preset-messages');
            presetMessages.forEach(message => {
                const option = document.createElement('option');
                option.value = message;
                option.textContent = message.length > 40 ? message.substring(0, 40) + '...' : message;
                messagesSelect.appendChild(option);
            });

            // Populate fonts
            const fontSelect = document.getElementById('font-family');
            fonts.forEach(font => {
                const option = document.createElement('option');
                option.value = font;
                option.textContent = font;
                option.style.fontFamily = font;
                fontSelect.appendChild(option);
            });

            // Load initial elements
            switchTab('diyas');
        }

        // Template Management
        function loadTemplate(template, index) {
            saveState(); // Save current state for undo
            
            currentTemplate = template;
            elements = [];
            
            // Apply background
            canvas.style.background = template.background.type === 'gradient' 
                ? `linear-gradient(135deg, ${template.background.colors[0]}, ${template.background.colors[1]})`
                : template.background.color || '#ffffff';
            
            // Add template elements
            if (template.elements) {
                template.elements.forEach(elementData => {
                    const element = createElementFromData(elementData);
                    elements.push(element);
                });
            }
            
            // Update UI
            document.querySelectorAll('.template-card').forEach((card, i) => {
                card.classList.toggle('active', i === index);
            });
            
            selectedElement = null;
            draw();
        }

        // Element Creation
        function createElementFromData(data) {
            const element = {
                id: Date.now() + Math.random(),
                type: data.type,
                x: data.x || 400,
                y: data.y || 300,
                width: data.width || data.size || 100,
                height: data.height || data.size || 100,
                rotation: data.rotation || 0,
                color: data.color || '#FFD700',
                selected: false
            };
            
            if (data.type === 'text') {
                element.content = data.content || 'Sample Text';
                element.fontSize = data.fontSize || 32;
                element.fontFamily = data.fontFamily || 'Cinzel';
                element.bold = data.bold || false;
                element.italic = data.italic || false;
                element.underline = data.underline || false;
                element.textAlign = data.textAlign || 'center';
            }
            
            return element;
        }

        // Drawing Functions
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw grid if enabled
            if (showGrid) {
                drawGrid();
            }
            
            // Draw all elements
            elements.forEach(element => {
                drawElement(element);
            });
            
            // Draw selection handles
            if (selectedElement) {
                drawSelectionHandles(selectedElement);
            }
        }

        function drawGrid() {
            const gridSize = 20;
            ctx.strokeStyle = 'rgba(200, 200, 200, 0.3)';
            ctx.lineWidth = 1;
            
            for (let x = 0; x <= canvas.width; x += gridSize) {
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
            
            for (let y = 0; y <= canvas.height; y += gridSize) {
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(canvas.width, y);
                ctx.stroke();
            }
        }

        function drawElement(element) {
            ctx.save();
            ctx.translate(element.x, element.y);
            ctx.rotate(element.rotation * Math.PI / 180);
            
            // Apply shadow if enabled
            if (element.shadow) {
                ctx.shadowColor = element.shadowColor || '#000000';
                ctx.shadowBlur = element.shadowBlur || 5;
                ctx.shadowOffsetX = 2;
                ctx.shadowOffsetY = 2;
            }
            
            switch (element.type) {
                case 'text':
                    drawText(element);
                    break;
                case 'diya':
                case 'classic-diya':
                case 'double-diya':
                case 'ornate-diya':
                case 'floating-diya':
                case 'golden-diya':
                    drawDiya(element);
                    break;
                case 'rangoli':
                case 'circular-rangoli':
                case 'square-rangoli':
                case 'lotus-rangoli':
                case 'peacock-rangoli':
                case 'geometric-rangoli':
                    drawRangoli(element);
                    break;
                case 'fireworks':
                case 'burst-red':
                case 'burst-gold':
                case 'burst-multi':
                case 'sparkler-gold':
                case 'rocket-trail':
                    drawFireworks(element);
                    break;
                case 'lotus':
                case 'lotus-pink':
                case 'lotus-white':
                    drawLotus(element);
                    break;
                case 'om':
                    drawOmSymbol(element);
                    break;
                case 'mandala':
                    drawMandala(element);
                    break;
                case 'peacock':
                    drawPeacock(element);
                    break;
                case 'geometric':
                    drawGeometric(element);
                    break;
                case 'sparkles':
                    drawSparkles(element);
                    break;
                case 'marigold':
                case 'rose':
                    drawFlower(element);
                    break;
                case 'stars':
                    drawStars(element);
                    break;
                default:
                    drawDefault(element);
            }
            
            ctx.restore();
        }

        // Specific Drawing Functions
        function drawText(element) {
            let fontStyle = '';
            if (element.bold) fontStyle += 'bold ';
            if (element.italic) fontStyle += 'italic ';
            
            ctx.font = `${fontStyle}${element.fontSize}px "${element.fontFamily}"`;
            ctx.fillStyle = element.color;
            ctx.textAlign = element.textAlign || 'center';
            ctx.textBaseline = 'middle';
            
            const lines = element.content.split('\n');
            const lineHeight = element.fontSize * 1.2;
            const startY = -(lines.length - 1) * lineHeight / 2;
            
            lines.forEach((line, index) => {
                const y = startY + index * lineHeight;
                ctx.fillText(line, 0, y);
                
                if (element.underline) {
                    const metrics = ctx.measureText(line);
                    ctx.beginPath();
                    ctx.moveTo(-metrics.width / 2, y + element.fontSize * 0.1);
                    ctx.lineTo(metrics.width / 2, y + element.fontSize * 0.1);
                    ctx.strokeStyle = element.color;
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }
            });
        }

        function drawDiya(element) {
            const size = Math.min(element.width, element.height);
            const radius = size / 2;
            
            // Base of diya
            ctx.beginPath();
            ctx.ellipse(0, radius * 0.3, radius * 0.8, radius * 0.4, 0, 0, 2 * Math.PI);
            ctx.fillStyle = element.color;
            ctx.fill();
            
            // Top of diya
            ctx.beginPath();
            ctx.ellipse(0, 0, radius * 0.6, radius * 0.3, 0, 0, 2 * Math.PI);
            ctx.fillStyle = '#8B4513';
            ctx.fill();
            
            // Flame
            ctx.beginPath();
            ctx.ellipse(0, -radius * 0.8, radius * 0.2, radius * 0.4, 0, 0, 2 * Math.PI);
            ctx.fillStyle = '#FF6B35';
            ctx.fill();
            
            // Inner flame
            ctx.beginPath();
            ctx.ellipse(0, -radius * 0.8, radius * 0.1, radius * 0.2, 0, 0, 2 * Math.PI);
            ctx.fillStyle = '#FFD700';
            ctx.fill();
        }

        function drawRangoli(element) {
            const size = Math.min(element.width, element.height);
            const radius = size / 2;
            const colors = ['#FF6B35', '#FFD700', '#9B59B6', '#E74C3C', '#2ECC71', '#3498DB'];
            
            for (let i = 0; i < 8; i++) {
                ctx.save();
                ctx.rotate((i * Math.PI) / 4);
                
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.lineTo(radius * 0.8, 0);
                ctx.arc(radius * 0.8, 0, radius * 0.2, 0, Math.PI);
                ctx.closePath();
                
                ctx.fillStyle = colors[i % colors.length];
                ctx.fill();
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                ctx.restore();
            }
            
            // Center circle
            ctx.beginPath();
            ctx.arc(0, 0, radius * 0.2, 0, 2 * Math.PI);
            ctx.fillStyle = '#FFD700';
            ctx.fill();
        }

        function drawFireworks(element) {
            const size = Math.min(element.width, element.height);
            const radius = size / 2;
            const colors = ['#FF6B35', '#FFD700', '#9B59B6', '#E74C3C', '#2ECC71'];
            
            for (let i = 0; i < 20; i++) {
                const angle = (i * 2 * Math.PI) / 20;
                const length = radius * (0.5 + Math.random() * 0.5);
                
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.lineTo(Math.cos(angle) * length, Math.sin(angle) * length);
                ctx.strokeStyle = colors[i % colors.length];
                ctx.lineWidth = 3;
                ctx.stroke();
                
                // Sparkle at the end
                ctx.beginPath();
                ctx.arc(Math.cos(angle) * length, Math.sin(angle) * length, 3, 0, 2 * Math.PI);
                ctx.fillStyle = colors[i % colors.length];
                ctx.fill();
            }
        }

        function drawLotus(element) {
            const size = Math.min(element.width, element.height);
            const radius = size / 2;
            
            // Draw petals
            for (let i = 0; i < 8; i++) {
                ctx.save();
                ctx.rotate((i * Math.PI) / 4);
                
                ctx.beginPath();
                ctx.ellipse(0, -radius * 0.7, radius * 0.3, radius * 0.5, 0, 0, 2 * Math.PI);
                ctx.fillStyle = element.color;
                ctx.fill();
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 1;
                ctx.stroke();
                
                ctx.restore();
            }
            
            // Center
            ctx.beginPath();
            ctx.arc(0, 0, radius * 0.2, 0, 2 * Math.PI);
            ctx.fillStyle = '#FFD700';
            ctx.fill();
        }

        function drawOmSymbol(element) {
            const size = Math.min(element.width, element.height);
            ctx.font = `${size}px serif`;
            ctx.fillStyle = element.color;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('‡•ê', 0, 0);
        }

        function drawMandala(element) {
            const size = Math.min(element.width, element.height);
            const radius = size / 2;
            const layers = 5;
            
            for (let layer = 0; layer < layers; layer++) {
                const layerRadius = radius * (layer + 1) / layers;
                const petals = 8 * (layer + 1);
                
                for (let i = 0; i < petals; i++) {
                    ctx.save();
                    ctx.rotate((i * 2 * Math.PI) / petals);
                    
                    ctx.beginPath();
                    ctx.arc(layerRadius * 0.8, 0, layerRadius * 0.1, 0, 2 * Math.PI);
                    ctx.fillStyle = `hsl(${45 + layer * 20}, 80%, ${60 + layer * 8}%)`;
                    ctx.fill();
                    
                    ctx.restore();
                }
            }
        }

        function drawPeacock(element) {
            const size = Math.min(element.width, element.height);
            const radius = size / 2;
            
            // Body
            ctx.beginPath();
            ctx.ellipse(0, radius * 0.3, radius * 0.2, radius * 0.6, 0, 0, 2 * Math.PI);
            ctx.fillStyle = '#2E8B57';
            ctx.fill();
            
            // Feather pattern
            for (let i = 0; i < 5; i++) {
                ctx.save();
                ctx.rotate((i * Math.PI) / 6 - Math.PI / 3);
                
                ctx.beginPath();
                ctx.ellipse(0, -radius * 0.8, radius * 0.15, radius * 0.4, 0, 0, 2 * Math.PI);
                ctx.fillStyle = `hsl(${200 + i * 20}, 70%, 50%)`;
                ctx.fill();
                
                // Eye spot
                ctx.beginPath();
                ctx.arc(0, -radius * 0.8, radius * 0.08, 0, 2 * Math.PI);
                ctx.fillStyle = '#FFD700';
                ctx.fill();
                
                ctx.restore();
            }
        }

        function drawGeometric(element) {
            const size = Math.min(element.width, element.height);
            const radius = size / 2;
            
            ctx.beginPath();
            for (let i = 0; i < 6; i++) {
                const angle = (i * Math.PI) / 3;
                const x = Math.cos(angle) * radius;
                const y = Math.sin(angle) * radius;
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.closePath();
            ctx.fillStyle = element.color;
            ctx.fill();
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.stroke();
        }

        function drawSparkles(element) {
            const size = Math.min(element.width, element.height);
            const count = Math.floor(size / 10);
            
            for (let i = 0; i < count; i++) {
                const x = (Math.random() - 0.5) * size;
                const y = (Math.random() - 0.5) * size;
                const sparkleSize = Math.random() * 8 + 2;
                
                ctx.save();
                ctx.translate(x, y);
                ctx.rotate(Math.random() * Math.PI);
                
                ctx.beginPath();
                ctx.moveTo(-sparkleSize, 0);
                ctx.lineTo(sparkleSize, 0);
                ctx.moveTo(0, -sparkleSize);
                ctx.lineTo(0, sparkleSize);
                ctx.strokeStyle = element.color;
                ctx.lineWidth = 2;
                ctx.stroke();
                
                ctx.restore();
            }
        }

        function drawFlower(element) {
            const size = Math.min(element.width, element.height);
            const radius = size / 2;
            
            // Draw petals
            for (let i = 0; i < 6; i++) {
                ctx.save();
                ctx.rotate((i * Math.PI) / 3);
                
                ctx.beginPath();
                ctx.ellipse(0, -radius * 0.6, radius * 0.25, radius * 0.4, 0, 0, 2 * Math.PI);
                ctx.fillStyle = element.color;
                ctx.fill();
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 1;
                ctx.stroke();
                
                ctx.restore();
            }
            
            // Center
            ctx.beginPath();
            ctx.arc(0, 0, radius * 0.15, 0, 2 * Math.PI);
            ctx.fillStyle = '#FFD700';
            ctx.fill();
        }

        function drawStars(element) {
            const size = Math.min(element.width, element.height);
            const radius = size / 2;
            
            ctx.beginPath();
            for (let i = 0; i < 10; i++) {
                const angle = (i * Math.PI) / 5;
                const r = i % 2 === 0 ? radius : radius * 0.5;
                const x = Math.cos(angle - Math.PI / 2) * r;
                const y = Math.sin(angle - Math.PI / 2) * r;
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.closePath();
            ctx.fillStyle = element.color;
            ctx.fill();
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.stroke();
        }

        function drawDefault(element) {
            ctx.fillStyle = element.color;
            ctx.fillRect(-element.width / 2, -element.height / 2, element.width, element.height);
        }

        function drawSelectionHandles(element) {
            ctx.save();
            ctx.setTransform(1, 0, 0, 1, 0, 0); // Reset transform
            
            const handleSize = 8;
            const x = element.x;
            const y = element.y;
            const w = element.width;
            const h = element.height;
            
            // Selection box
            ctx.strokeStyle = '#007bff';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.strokeRect(x - w/2, y - h/2, w, h);
            ctx.setLineDash([]);
            
            // Resize handles
            const handles = [
                { x: x - w/2, y: y - h/2 }, // top-left
                { x: x + w/2, y: y - h/2 }, // top-right
                { x: x + w/2, y: y + h/2 }, // bottom-right
                { x: x - w/2, y: y + h/2 }, // bottom-left
                { x: x, y: y - h/2 },       // top-center
                { x: x + w/2, y: y },       // middle-right
                { x: x, y: y + h/2 },       // bottom-center
                { x: x - w/2, y: y }        // middle-left
            ];
            
            handles.forEach(handle => {
                ctx.fillStyle = '#007bff';
                ctx.fillRect(handle.x - handleSize/2, handle.y - handleSize/2, handleSize, handleSize);
                ctx.strokeStyle = '#fff';
                ctx.strokeRect(handle.x - handleSize/2, handle.y - handleSize/2, handleSize, handleSize);
            });
            
            // Rotation handle
            ctx.fillStyle = '#ffc107';
            ctx.beginPath();
            ctx.arc(x, y - h/2 - 20, 6, 0, 2 * Math.PI);
            ctx.fill();
            ctx.strokeStyle = '#fff';
            ctx.stroke();
            
            ctx.restore();
        }

        // Mouse Event Handlers
        function handleMouseDown(e) {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            const clickedElement = getElementAt(x, y);
            
            if (clickedElement) {
                selectedElement = clickedElement;
                isDragging = true;
                dragOffset = {
                    x: x - clickedElement.x,
                    y: y - clickedElement.y
                };
                draw();
            } else {
                selectedElement = null;
                draw();
            }
        }

        function handleMouseMove(e) {
            if (!isDragging || !selectedElement) return;
            
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            selectedElement.x = x - dragOffset.x;
            selectedElement.y = y - dragOffset.y;
            
            draw();
        }

        function handleMouseUp() {
            if (isDragging) {
                saveState();
            }
            isDragging = false;
            isResizing = false;
        }

        function handleCanvasClick(e) {
            // This is handled by mousedown for better control
        }

        function getElementAt(x, y) {
            // Check elements in reverse order (top to bottom)
            for (let i = elements.length - 1; i >= 0; i--) {
                const element = elements[i];
                if (isPointInElement(x, y, element)) {
                    return element;
                }
            }
            return null;
        }

        function isPointInElement(x, y, element) {
            const dx = x - element.x;
            const dy = y - element.y;
            return Math.abs(dx) <= element.width / 2 && Math.abs(dy) <= element.height / 2;
        }

        // Keyboard Event Handler
        function handleKeyDown(e) {
            if (e.key === 'Delete' || e.key === 'Backspace') {
                deleteSelected();
            } else if (e.ctrlKey || e.metaKey) {
                switch (e.key) {
                    case 'z':
                        e.preventDefault();
                        undo();
                        break;
                    case 'y':
                        e.preventDefault();
                        redo();
                        break;
                }
            }
        }

        // Text Functions
        function addText() {
            const textInput = document.getElementById('text-input');
            const text = textInput.value.trim();
            
            if (!text) {
                showToast('Please enter some text!');
                return;
            }
            
            saveState();
            
            const fontSize = parseInt(document.getElementById('font-size').value);
            const fontFamily = document.getElementById('font-family').value;
            const color = document.getElementById('text-color').value;
            
            const textElement = {
                id: Date.now(),
                type: 'text',
                content: text,
                x: canvas.width / 2,
                y: canvas.height / 2,
                fontSize: fontSize,
                fontFamily: fontFamily,
                color: color,
                bold: textFormatting.bold,
                italic: textFormatting.italic,
                underline: textFormatting.underline,
                textAlign: 'center',
                width: 200, // Approximate for selection
                height: fontSize * 1.2,
                rotation: 0,
                selected: false
            };
            
            elements.push(textElement);
            selectedElement = textElement;
            textInput.value = '';
            draw();
        }

        function updateSelectedText() {
            if (!selectedElement || selectedElement.type !== 'text') return;
            
            selectedElement.fontFamily = document.getElementById('font-family').value;
            selectedElement.fontSize = parseInt(document.getElementById('font-size').value);
            selectedElement.color = document.getElementById('text-color').value;
            selectedElement.height = selectedElement.fontSize * 1.2;
            
            draw();
        }

        function updateRecipientName() {
            const name = document.getElementById('recipient-name').value.trim();
            
            // Find existing recipient text or create new one
            let recipientElement = elements.find(el => el.type === 'text' && el.isRecipient);
            
            if (name) {
                if (!recipientElement) {
                    saveState();
                    recipientElement = {
                        id: Date.now(),
                        type: 'text',
                        content: `Dear ${name},`,
                        x: canvas.width / 2,
                        y: 100,
                        fontSize: 28,
                        fontFamily: 'Great Vibes',
                        color: '#FFD700',
                        bold: false,
                        italic: true,
                        underline: false,
                        textAlign: 'center',
                        width: 200,
                        height: 34,
                        rotation: 0,
                        selected: false,
                        isRecipient: true
                    };
                    elements.unshift(recipientElement); // Add at beginning
                } else {
                    recipientElement.content = `Dear ${name},`;
                }
                draw();
            } else if (recipientElement) {
                saveState();
                elements = elements.filter(el => el !== recipientElement);
                draw();
            }
        }

        function insertMessage() {
            const select = document.getElementById('preset-messages');
            const message = select.value;
            
            if (!message) {
                showToast('Please select a message!');
                return;
            }
            
            document.getElementById('text-input').value = message;
            select.value = '';
        }

        // Text Formatting
        function toggleBold() {
            textFormatting.bold = !textFormatting.bold;
            document.getElementById('bold-btn').classList.toggle('active', textFormatting.bold);
            
            if (selectedElement && selectedElement.type === 'text') {
                selectedElement.bold = textFormatting.bold;
                draw();
            }
        }

        function toggleItalic() {
            textFormatting.italic = !textFormatting.italic;
            document.getElementById('italic-btn').classList.toggle('active', textFormatting.italic);
            
            if (selectedElement && selectedElement.type === 'text') {
                selectedElement.italic = textFormatting.italic;
                draw();
            }
        }

        function toggleUnderline() {
            textFormatting.underline = !textFormatting.underline;
            document.getElementById('underline-btn').classList.toggle('active', textFormatting.underline);
            
            if (selectedElement && selectedElement.type === 'text') {
                selectedElement.underline = textFormatting.underline;
                draw();
            }
        }

        // Element Functions
        function addElement(elementType) {
            saveState();
            
            const element = {
                id: Date.now(),
                type: elementType,
                x: canvas.width / 2 + (Math.random() - 0.5) * 100,
                y: canvas.height / 2 + (Math.random() - 0.5) * 100,
                width: 80,
                height: 80,
                rotation: 0,
                color: '#FFD700',
                selected: false
            };
            
            elements.push(element);
            selectedElement = element;
            draw();
        }

        function switchTab(category) {
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-tab="${category}"]`).classList.add('active');
            
            // Update elements grid
            const elementsGrid = document.getElementById('elements-grid');
            elementsGrid.innerHTML = '';
            
            const categoryElements = elementCategories[category] || elementCategories.diyas;
            
            categoryElements.forEach(element => {
                const button = document.createElement('button');
                button.className = 'element-button';
                button.innerHTML = element.icon;
                button.title = element.name;
                button.onclick = () => addElement(element.name);
                elementsGrid.appendChild(button);
            });
        }

        // Color Theme Functions
        function applyColorTheme(theme, index) {
            if (!currentTemplate) return;
            
            saveState();
            
            // Update canvas background
            canvas.style.background = `linear-gradient(135deg, ${theme.colors[0]}, ${theme.colors[1]})`;
            
            // Update existing text elements with theme colors
            elements.forEach(element => {
                if (element.type === 'text' && !element.isRecipient) {
                    element.color = theme.colors[0];
                } else if (element.type !== 'text') {
                    element.color = theme.colors[Math.floor(Math.random() * theme.colors.length)];
                }
            });
            
            // Update UI
            document.querySelectorAll('.color-theme').forEach((el, i) => {
                el.classList.toggle('active', i === index);
            });
            
            draw();
        }

        // Effect Functions
        function toggleShadow() {
            const enabled = document.getElementById('shadow-enabled').checked;
            
            if (selectedElement) {
                if (enabled) {
                    selectedElement.shadow = true;
                    selectedElement.shadowColor = document.getElementById('shadow-color').value;
                    selectedElement.shadowBlur = parseInt(document.getElementById('shadow-blur').value);
                } else {
                    selectedElement.shadow = false;
                }
                draw();
            }
        }

        function updateShadow() {
            if (selectedElement && selectedElement.shadow) {
                selectedElement.shadowColor = document.getElementById('shadow-color').value;
                selectedElement.shadowBlur = parseInt(document.getElementById('shadow-blur').value);
                draw();
            }
        }

        // Action Functions
        function deleteSelected() {
            if (!selectedElement) {
                showToast('No element selected!');
                return;
            }
            
            saveState();
            elements = elements.filter(el => el !== selectedElement);
            selectedElement = null;
            draw();
        }

        function clearAll() {
            if (elements.length === 0) {
                showToast('Canvas is already empty!');
                return;
            }
            
            if (confirm('Are you sure you want to clear all elements?')) {
                saveState();
                elements = [];
                selectedElement = null;
                draw();
            }
        }

        function newCard() {
            if (elements.length > 0) {
                if (confirm('Start a new card? This will clear your current work.')) {
                    saveCardToHistory();
                    elements = [];
                    selectedElement = null;
                    canvas.style.background = '#ffffff';
                    document.getElementById('recipient-name').value = '';
                    currentTemplate = null;
                    draw();
                }
            }
        }

        function resetToTemplate() {
            if (currentTemplate) {
                if (confirm('Reset to original template? This will lose your current changes.')) {
                    loadTemplate(currentTemplate);
                }
            } else {
                showToast('No template selected!');
            }
        }

        // History Management
        function saveState() {
            const state = {
                elements: JSON.parse(JSON.stringify(elements)),
                background: canvas.style.background,
                template: currentTemplate
            };
            
            undoStack.push(state);
            if (undoStack.length > 10) {
                undoStack.shift();
            }
            redoStack = []; // Clear redo stack on new action
            
            updateUndoRedoButtons();
        }

        function undo() {
            if (undoStack.length === 0) {
                showToast('Nothing to undo!');
                return;
            }
            
            const currentState = {
                elements: JSON.parse(JSON.stringify(elements)),
                background: canvas.style.background,
                template: currentTemplate
            };
            
            redoStack.push(currentState);
            const previousState = undoStack.pop();
            
            elements = previousState.elements;
            canvas.style.background = previousState.background;
            currentTemplate = previousState.template;
            selectedElement = null;
            
            updateUndoRedoButtons();
            draw();
        }

        function redo() {
            if (redoStack.length === 0) {
                showToast('Nothing to redo!');
                return;
            }
            
            const currentState = {
                elements: JSON.parse(JSON.stringify(elements)),
                background: canvas.style.background,
                template: currentTemplate
            };
            
            undoStack.push(currentState);
            const nextState = redoStack.pop();
            
            elements = nextState.elements;
            canvas.style.background = nextState.background;
            currentTemplate = nextState.template;
            selectedElement = null;
            
            updateUndoRedoButtons();
            draw();
        }

        function updateUndoRedoButtons() {
            document.getElementById('undo-btn').disabled = undoStack.length === 0;
            document.getElementById('redo-btn').disabled = redoStack.length === 0;
        }

        // Card History
        function saveCardToHistory() {
            const thumbnail = canvas.toDataURL('image/png');
            const cardData = {
                id: Date.now(),
                thumbnail: thumbnail,
                elements: JSON.parse(JSON.stringify(elements)),
                background: canvas.style.background,
                template: currentTemplate,
                timestamp: new Date()
            };
            
            cardHistory.unshift(cardData);
            if (cardHistory.length > 5) {
                cardHistory.pop();
            }
            
            updateCardHistoryDisplay();
        }

        function updateCardHistoryDisplay() {
            const historyContainer = document.getElementById('card-history');
            historyContainer.innerHTML = '';
            
            cardHistory.forEach(card => {
                const thumbnail = document.createElement('canvas');
                thumbnail.width = 80;
                thumbnail.height = 60;
                thumbnail.className = 'history-thumbnail';
                thumbnail.title = `Card from ${card.timestamp.toLocaleString()}`;
                
                const thumbCtx = thumbnail.getContext('2d');
                const img = new Image();
                img.onload = () => {
                    thumbCtx.drawImage(img, 0, 0, 80, 60);
                };
                img.src = card.thumbnail;
                
                thumbnail.onclick = () => loadCardFromHistory(card);
                historyContainer.appendChild(thumbnail);
            });
        }

        function loadCardFromHistory(cardData) {
            if (confirm('Load this card? This will replace your current work.')) {
                saveState();
                elements = cardData.elements;
                canvas.style.background = cardData.background;
                currentTemplate = cardData.template;
                selectedElement = null;
                draw();
            }
        }

        // Canvas Controls
        function toggleGrid() {
            showGrid = !showGrid;
            document.getElementById('grid-toggle').textContent = showGrid ? 'Grid: ON' : 'Grid: OFF';
            draw();
        }

        function zoomIn() {
            canvasZoom = Math.min(canvasZoom * 1.1, 2);
            updateZoom();
        }

        function zoomOut() {
            canvasZoom = Math.max(canvasZoom * 0.9, 0.5);
            updateZoom();
        }

        function updateZoom() {
            canvas.style.transform = `scale(${canvasZoom})`;
            document.getElementById('zoom-level').textContent = Math.round(canvasZoom * 100) + '%';
        }

        // Download & Share Functions
        function downloadCard() {
            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = 'üíæ Downloading... <span class="spinner"></span>';
            button.disabled = true;
            
            setTimeout(() => {
                try {
                    // Create a temporary canvas with white background
                    const tempCanvas = document.createElement('canvas');
                    tempCanvas.width = canvas.width;
                    tempCanvas.height = canvas.height;
                    const tempCtx = tempCanvas.getContext('2d');
                    
                    // Fill with white background
                    tempCtx.fillStyle = '#ffffff';
                    tempCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
                    
                    // Apply gradient background if exists
                    if (canvas.style.background && canvas.style.background.includes('gradient')) {
                        const gradient = tempCtx.createLinearGradient(0, 0, tempCanvas.width, tempCanvas.height);
                        // Parse the gradient colors from canvas style
                        const gradientMatch = canvas.style.background.match(/rgb\([^)]+\)/g);
                        if (gradientMatch && gradientMatch.length >= 2) {
                            gradient.addColorStop(0, gradientMatch[0]);
                            gradient.addColorStop(1, gradientMatch[1]);
                            tempCtx.fillStyle = gradient;
                            tempCtx.fillRect(0, 0, tempCanvas.width, tempCanvas.height);
                        }
                    }
                    
                    // Draw all elements on temp canvas
                    elements.forEach(element => {
                        tempCtx.save();
                        tempCtx.translate(element.x, element.y);
                        tempCtx.rotate(element.rotation * Math.PI / 180);
                        
                        // Apply shadow
                        if (element.shadow) {
                            tempCtx.shadowColor = element.shadowColor || '#000000';
                            tempCtx.shadowBlur = element.shadowBlur || 5;
                            tempCtx.shadowOffsetX = 2;
                            tempCtx.shadowOffsetY = 2;
                        }
                        
                        // Draw element (reuse existing draw functions)
                        const originalCtx = ctx;
                        ctx = tempCtx;
                        switch (element.type) {
                            case 'text':
                                drawText(element);
                                break;
                            case 'diya':
                            case 'classic-diya':
                            case 'double-diya':
                            case 'ornate-diya':
                            case 'floating-diya':
                            case 'golden-diya':
                                drawDiya(element);
                                break;
                            case 'rangoli':
                            case 'circular-rangoli':
                            case 'square-rangoli':
                            case 'lotus-rangoli':
                            case 'peacock-rangoli':
                            case 'geometric-rangoli':
                                drawRangoli(element);
                                break;
                            case 'fireworks':
                            case 'burst-red':
                            case 'burst-gold':
                            case 'burst-multi':
                            case 'sparkler-gold':
                            case 'rocket-trail':
                                drawFireworks(element);
                                break;
                            case 'lotus':
                            case 'lotus-pink':
                            case 'lotus-white':
                                drawLotus(element);
                                break;
                            case 'om':
                                drawOmSymbol(element);
                                break;
                            case 'mandala':
                                drawMandala(element);
                                break;
                            case 'peacock':
                                drawPeacock(element);
                                break;
                            case 'geometric':
                                drawGeometric(element);
                                break;
                            case 'sparkles':
                                drawSparkles(element);
                                break;
                            case 'marigold':
                            case 'rose':
                                drawFlower(element);
                                break;
                            case 'stars':
                                drawStars(element);
                                break;
                            default:
                                drawDefault(element);
                        }
                        ctx = originalCtx;
                        
                        tempCtx.restore();
                    });
                    
                    // Download the image
                    const dataURL = tempCanvas.toDataURL('image/png');
                    const link = document.createElement('a');
                    const recipientName = document.getElementById('recipient-name').value.trim() || 'Friend';
                    const date = new Date().toISOString().split('T')[0];
                    link.download = `Diwali_Greeting_${recipientName}_${date}.png`;
                    link.href = dataURL;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    saveCardToHistory();
                    showToast('Card downloaded successfully!');
                    
                } catch (error) {
                    showToast('Download failed. Please try again.');
                    console.error('Download error:', error);
                } finally {
                    button.innerHTML = originalText;
                    button.disabled = false;
                }
            }, 500);
        }

        function shareCard() {
            try {
                const dataURL = canvas.toDataURL('image/png');
                
                // Show share modal
                const modalContent = `
                    <h3 style="font-family: 'Cinzel', serif; color: var(--color-primary); margin-bottom: 20px;">Share Your Diwali Card</h3>
                    <div style="text-align: center; margin-bottom: 20px;">
                        <img src="${dataURL}" style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: var(--shadow-md);" alt="Your Diwali Card">
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                        <button class="btn btn--primary" onclick="copyToClipboard('${dataURL}')">
                            üìã Copy Image
                        </button>
                        <button class="btn btn--secondary" onclick="openShareDialog()">
                            üì§ Share Link
                        </button>
                    </div>
                    <p style="margin-top: 16px; font-size: 12px; color: var(--color-text-secondary); text-align: center;">
                        Note: In a real application, sharing would integrate with social media platforms.
                    </p>
                `;
                
                showModal(modalContent);
                
            } catch (error) {
                showToast('Share preparation failed. Please try again.');
                console.error('Share error:', error);
            }
        }

        function copyToClipboard(dataURL) {
            // Convert data URL to blob
            fetch(dataURL)
                .then(res => res.blob())
                .then(blob => {
                    const item = new ClipboardItem({ 'image/png': blob });
                    return navigator.clipboard.write([item]);
                })
                .then(() => {
                    showToast('Card image copied to clipboard!');
                    closeModal();
                })
                .catch(() => {
                    // Fallback for browsers that don't support clipboard API
                    showToast('Copy to clipboard not supported in this browser. Try downloading instead.');
                });
        }

        function openShareDialog() {
            showToast('In a real app, this would open social media sharing options!');
            closeModal();
        }

        // Theme Toggle
        function toggleTheme() {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.body.setAttribute('data-color-scheme', currentTheme);
            document.getElementById('theme-icon').textContent = currentTheme === 'light' ? 'üåô' : '‚òÄÔ∏è';
            draw(); // Redraw to apply theme changes
        }

        // Utility Functions
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            
            toastMessage.textContent = message;
            toast.className = `toast ${type}`;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function showModal(content) {
            const modal = document.getElementById('modal');
            const modalContent = document.getElementById('modal-content');
            
            modalContent.innerHTML = content;
            modal.classList.add('show');
            
            // Close on background click
            modal.onclick = (e) => {
                if (e.target === modal) {
                    closeModal();
                }
            };
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('show');
        }

        // Auto-save function
        function autoSave() {
            if (elements.length > 0) {
                const autoSaveData = {
                    elements: elements,
                    background: canvas.style.background,
                    template: currentTemplate,
                    timestamp: new Date()
                };
                // In a real app, this would save to a database
                console.log('Auto-saved card data:', autoSaveData);
            }
        }

        // Set up auto-save every 30 seconds
        setInterval(autoSave, 30000);

        // Initialize the application when page loads
        window.addEventListener('load', initializeApp);
        
        // Prevent context menu on canvas
        document.getElementById('greeting-canvas').addEventListener('contextmenu', e => e.preventDefault());
    </script>
</body>
</html>
